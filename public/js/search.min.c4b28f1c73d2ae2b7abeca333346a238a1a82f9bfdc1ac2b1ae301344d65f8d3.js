document.addEventListener("DOMContentLoaded",function(){const i=window.location.pathname.split("/"),c=i[1]==="it"||i[1]==="en"?i[1]:"en",l=document.getElementById("searchButton"),s=document.getElementById("searchContainer"),t=document.getElementById("searchInput"),e=document.getElementById("searchResults");if(!l||!s||!t||!e){console.error("Search elements not found");return}let a=null,r=!1;const o=`/${c}/index.json`;console.log("Fetching search data from:",o),fetch(o).then(e=>{if(!e.ok)throw console.error("Failed to fetch:",o,e.status),new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(console.log("Search data loaded:",e),!e||!e.items||!Array.isArray(e.items))throw new Error("Invalid data format");f(e.items)}).catch(e=>{console.error("Errore nel caricamento dei dati di ricerca:",e)}),l.addEventListener("click",e=>{if(e.stopPropagation(),r)return;r=!0;const t=s.classList.contains("active");n(!t),setTimeout(()=>{r=!1},400)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&(e.key==="k"||e.key==="K")&&(e.preventDefault(),n(!0)),e.key==="Escape"&&n(!1)}),t.addEventListener("keydown",function(e){e.key==="Enter"&&e.preventDefault()});const m=e=>{const t=e.target.value.trim();if(!a){console.error("Search not initialized");return}if(t.length>=2){const e=a.search(t);p(e,t)}else u()};t.addEventListener("input",v(m,200));function f(e){const t={keys:[{name:"title",weight:2},{name:"content",weight:1},{name:"tags",weight:1.5}],threshold:.3,ignoreLocation:!0,minMatchCharLength:2};a=new Fuse(e,t)}function n(e){const n=document.querySelector(".search-container");e?(n.style.display="block",setTimeout(()=>{n.classList.add("active"),document.body.classList.add("scroll-lock"),t.focus()},10)):(n.classList.remove("active"),document.body.classList.remove("scroll-lock"),setTimeout(()=>{n.style.display="none",t.value="",u()},300))}function p(t,n){if(!t||!Array.isArray(t)){console.error("Invalid results:",t);return}if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="no-results">
        ${c==="it"?"Nessun risultato trovato":"No results found"}
      </div>`;return}t.forEach(t=>{if(!t||!t.item)return;const s=t.item,o=document.createElement("div");o.className="result-item";const i=g(s.content||"",n);o.innerHTML=`
        <a href="${s.permalink}" class="result-title">${d(s.title||"",n)}</a>
        <div class="result-meta">
          ${s.date||""} ${s.tags?`â€¢ ${s.tags.join(", ")}`:""}
        </div>
        <div class="result-snippet">${i}</div>
      `,e.appendChild(o)})}function g(e,t){if(!e||!t)return"";const i=e.split(" "),n=e.toLowerCase().indexOf(t.toLowerCase());if(n===-1)return e.slice(0,200)+"...";const s=Math.max(0,n-100),o=Math.min(e.length,n+100);return"..."+d(e.slice(s,o),t)+"..."}function d(e,t){if(!e||!t)return e||"";const n=new RegExp(`(${t})`,"gi");return e.replace(n,'<span class="highlight">$1</span>')}function u(){e&&(e.innerHTML="")}function v(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}s.addEventListener("click",function(e){e.target===s&&n(!1)}),e.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("click",function(e){e.stopPropagation()});const h=document.querySelector(".search-box");h&&h.addEventListener("click",e=>{e.stopPropagation()})})