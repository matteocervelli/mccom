document.addEventListener("DOMContentLoaded",function(){const c=window.location.pathname.split("/")[1]||"en",r=document.getElementById("searchButton"),s=document.getElementById("searchContainer"),t=document.getElementById("searchInput"),e=document.getElementById("searchResults");if(!r||!s||!t||!e){console.error("Search elements not found");return}let i=null;const o=c==="it"?"/it/index.json":"/en/index.json";console.log("Fetching search data from:",o),fetch(o).then(e=>{if(!e.ok)throw console.error("Failed to fetch:",o,e.status),new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(console.log("Search data loaded:",e),!e||!e.items||!Array.isArray(e.items))throw new Error("Invalid data format");h(e.items)}).catch(e=>{console.error("Errore nel caricamento dei dati di ricerca:",e)}),r.addEventListener("click",e=>{e.stopPropagation();const t=s.classList.contains("active");n(!t)}),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&(e.key==="k"||e.key==="K")&&(e.preventDefault(),n(!0)),e.key==="Escape"&&n(!1)}),t.addEventListener("keydown",function(e){e.key==="Enter"&&e.preventDefault()});const u=e=>{const t=e.target.value.trim();if(!i){console.error("Search not initialized");return}if(t.length>=2){const e=i.search(t);m(e,t)}else l()};t.addEventListener("input",p(u,200));function h(e){const t={keys:[{name:"title",weight:2},{name:"content",weight:1},{name:"tags",weight:1.5}],threshold:.3,ignoreLocation:!0,minMatchCharLength:2};i=new Fuse(e,t)}function n(e){const n=document.querySelector(".search-container");e?(n.style.display="block",setTimeout(()=>{n.classList.add("active"),document.body.classList.add("scroll-lock"),t.focus()},10)):(n.classList.remove("active"),document.body.classList.remove("scroll-lock"),setTimeout(()=>{n.style.display="none",t.value="",l()},300))}function m(t,n){if(!t||!Array.isArray(t)){console.error("Invalid results:",t);return}if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="no-results">
        ${c==="it"?"Nessun risultato trovato":"No results found"}
      </div>`;return}t.forEach(t=>{if(!t||!t.item)return;const s=t.item,o=document.createElement("div");o.className="result-item";const i=f(s.content||"",n);o.innerHTML=`
        <a href="${s.permalink}" class="result-title">${a(s.title||"",n)}</a>
        <div class="result-meta">
          ${s.date||""} ${s.tags?`â€¢ ${s.tags.join(", ")}`:""}
        </div>
        <div class="result-snippet">${i}</div>
      `,e.appendChild(o)})}function f(e,t){if(!e||!t)return"";const i=e.split(" "),n=e.toLowerCase().indexOf(t.toLowerCase());if(n===-1)return e.slice(0,200)+"...";const s=Math.max(0,n-100),o=Math.min(e.length,n+100);return"..."+a(e.slice(s,o),t)+"..."}function a(e,t){if(!e||!t)return e||"";const n=new RegExp(`(${t})`,"gi");return e.replace(n,'<span class="highlight">$1</span>')}function l(){e&&(e.innerHTML="")}function p(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}s.addEventListener("click",function(e){e.target===s&&n(!1)}),e.addEventListener("click",function(e){e.stopPropagation()}),t.addEventListener("click",function(e){e.stopPropagation()});const d=document.querySelector(".search-box");d&&d.addEventListener("click",e=>{e.stopPropagation()})})