document.addEventListener("DOMContentLoaded",function(){const r=window.location.pathname.split("/")[1]||"en",a=document.getElementById("searchButton"),n=document.getElementById("searchContainer"),t=document.getElementById("searchInput"),e=document.getElementById("searchResults");if(!a||!n||!t||!e){console.error("Search elements not found");return}let o=null;const s=r==="it"?"/it/index.json":"/en/index.json";console.log("Fetching search data from:",s),fetch(s).then(e=>{if(!e.ok)throw console.error("Failed to fetch:",s,e.status),new Error(`HTTP error! status: ${e.status}`);return e.json()}).then(e=>{if(console.log("Search data loaded:",e),!e||!e.items||!Array.isArray(e.items))throw new Error("Invalid data format");u(e.items)}).catch(e=>{console.error("Errore nel caricamento dei dati di ricerca:",e)}),a.addEventListener("click",()=>i(!0)),document.addEventListener("keydown",function(e){(e.metaKey||e.ctrlKey)&&(e.key==="k"||e.key==="K")&&(e.preventDefault(),i(!0)),e.key==="Escape"&&i(!1)}),t.addEventListener("keydown",function(e){e.key==="Enter"&&e.preventDefault()});const d=e=>{const t=e.target.value.trim();if(!o){console.error("Search not initialized");return}if(t.length>=2){const e=o.search(t);h(e,t)}else l()};t.addEventListener("input",f(d,200));function u(e){const t={keys:[{name:"title",weight:2},{name:"content",weight:1},{name:"tags",weight:1.5}],threshold:.3,ignoreLocation:!0,minMatchCharLength:2};o=new Fuse(e,t)}function i(e){e?(n.style.display="block",setTimeout(()=>{n.classList.add("active"),t.focus()},10)):(n.classList.remove("active"),setTimeout(()=>{n.style.display="none",t.value="",l()},300))}function h(t,n){if(!t||!Array.isArray(t)){console.error("Invalid results:",t);return}if(e.innerHTML="",t.length===0){e.innerHTML=`<div class="no-results">
        ${r==="it"?"Nessun risultato trovato":"No results found"}
      </div>`;return}t.forEach(t=>{if(!t||!t.item)return;const s=t.item,o=document.createElement("div");o.className="result-item";const i=m(s.content||"",n);o.innerHTML=`
        <a href="${s.permalink}" class="result-title">${c(s.title||"",n)}</a>
        <div class="result-meta">
          ${s.date||""} ${s.tags?`â€¢ ${s.tags.join(", ")}`:""}
        </div>
        <div class="result-snippet">${i}</div>
      `,e.appendChild(o)})}function m(e,t){if(!e||!t)return"";const i=e.split(" "),n=e.toLowerCase().indexOf(t.toLowerCase());if(n===-1)return e.slice(0,200)+"...";const s=Math.max(0,n-100),o=Math.min(e.length,n+100);return"..."+c(e.slice(s,o),t)+"..."}function c(e,t){if(!e||!t)return e||"";const n=new RegExp(`(${t})`,"gi");return e.replace(n,'<span class="highlight">$1</span>')}function l(){e&&(e.innerHTML="")}function f(e,t){let n;return function(...s){clearTimeout(n),n=setTimeout(()=>e.apply(this,s),t)}}})